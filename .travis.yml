language: go
go_import_path: github.com/whiteblock/genesis
sudo: false
env:
#  - GO111MODULE=on
matrix:
  include:
    - os: linux
      dist: xenial
      sudo: required
      go: 1.12.5
      install:
        - sudo apt-get install golint mockgen -y
      before_script:
        - go get github.com/whiteblock/genesis
        - go get github.com/golang/mock/gomock
        - mockgen -source=/home/travis/gopath/src/github.com/whiteblock/genesis/ssh/client.go -destination=/home/travis/gopath/src/github.com/whiteblock/genesis/net/mocks/client_mock.go -package=mocks
      script:
        - go test github.com/whiteblock/genesis/...
        - golint github.com/whiteblock/genesis/...
        - go vet github.com/whiteblock/genesis/...
        - go fmt $(go list ./... | grep -v /net/mocks/)
        - go test $(go list ./... | grep -v /net/mocks/)
        - go test github.com/whiteblock/genesis/... -race -coverprofile=coverage.txt -covermode=atomic
        - go build github.com/whiteblock/genesis
      after_success:
        - bash <(curl -s https://codecov.io/bash)
